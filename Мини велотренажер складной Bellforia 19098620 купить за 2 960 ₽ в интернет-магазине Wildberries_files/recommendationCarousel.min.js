(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function _iterableToArrayLimit(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],s=!0,r=!1,o=void 0;try{for(var i,a=t[Symbol.iterator]();!(s=(i=a.next()).done)&&(n.push(i.value),!e||n.length!==e);s=!0);}catch(t){r=!0,o=t}finally{try{s||null==a.return||a.return()}finally{if(r)throw o}}return n}}function _arrayWithHoles(t){if(Array.isArray(t))return t}!function(){var t=function(){function t(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.rootElement=t instanceof Element?t:document.querySelector(t),this.settings=this.$helper.deepMerge({},{loadWhenVisible:!0,tmplName:"RecommendationsCarouselTmpl",type:8,imageSize:"small",sliderSlr:".j-carousel",visibleCount:7,originalImgAtr:"original-src",loop:!0,needDenom:!0,sameWindow:!1},e),this._bindEvents()}var e=t.prototype;return e.showWhenInViewPortAsync=function(){var t=this;if("IntersectionObserver"in window)this.observer=new IntersectionObserver(function(e,n){e.forEach(function(e){var s=e.isIntersecting,r=e.intersectionRatio;(s||r>0)&&(t.showAsync(),n.unobserve(t.rootElement))})},{rootMargin:"100px"}),this.observer.observe(this.rootElement);else{var e=this.rootElement.getBoundingClientRect().top;document.documentElement.clientHeight>e?this.showAsync():(this._onScrollLoad=this.$helper.throttle(function(){window.pageYOffset>=e-500&&(window.removeEventListener("scroll",t._onScrollLoad),t.showAsync())},300),window.addEventListener("scroll",this._onScrollLoad))}return this},e.showAsync=function(){var t=this;return Promise.all([this._loadRequiredTemplate(),this._loadGoodsAsync(),this._loadRequiredModules()]).then(function(e){var n=_slicedToArray(e,3),s=n[0],r=n[1],o=n[2];r&&r.goods&&r.goods.length&&(t.settings.fillPrices?t._fillGoodsAsync(r.nms,r.goods).then(function(e){e&&e.length&&(r.goods=e,t._showAsync(r,s,o))}):t._showAsync(r,s,o))})},e.destroy=function(){this.observer&&this.observer.unobserve(this.rootElement),window.removeEventListener("scroll",this._onScrollLoad)},e._bindEvents=function(){var t=this;this.rootElement.addEventListener("click",this.$helper.delegator(".j-open-product-popup",function(e,n){e.preventDefault(),e.stopPropagation();var s=n.closest(".j-product-item");t.$moduleLoader.loadModuleAsync("productCardPopup").then(function(e){var n=document.querySelectorAll(".j-product-item").toArray();new e(e.data,e.template).showSlider({cod1S:s.dataset.popupNmId,charId:null,rowId:null,newTargetUrl:t.settings.targetUrl||"MI",onSlideMove:t._onPopupSlideMove.bind(t)},n,n.findIndex(function(t){return t==s}))}).catch(function(t){console.log(t.message),window.location.href=n.href})})),this.rootElement.addEventListener("click",this.$helper.delegator("a",function(e,n){var s=n.closest(".j-product-item");if(t.settings.sendStats&&t._statsSendClick(s.dataset.popupNmId),t.settings.analiticsCode){var r=null==s?0:t.recommendations.goods.findIndex(function(t){return t.cod1S==s.dataset.popupNmId});t.$analitic.saveState({l:t.settings.analiticsCode,iid:r})}}))},e._showAsync=function(t,e,n){var s=this;this.recommendations=t,this.rootElement.innerHTML=e(this.$helper.deepMerge(t,this.settings)),new n(this.rootElement.querySelectorAll(".j-carousel"),{autoWidth:!0,disableArrows:!0,easing:"linear",speed:200,loop:this.settings.loop,slideEndAnimation:!0,useCSS:!0,controls:!0,prevHtml:'<button class="btn-prev"></button>',nextHtml:'<button class="btn-next"></button>',vertical:!1,pager:!1,swipeThreshold:40,slideMargin:30,onSliderLoad:function(){s.rootElement.querySelector(".j-b-slider-wrapper").classList.remove("cS-hidden"),s.settings.sendStats&&s._statsSendShow()},onBeforeSlide:function(t){var e=t.querySelectorAll("img[".concat(s.settings.originalImgAtr,"]"));e.length&&e.forEach(function(t){t.src=t.getAttribute(s.settings.originalImgAtr),t.removeAttribute(s.settings.originalImgAtr)})}})},e._onPopupSlideMove=function(t){this.settings.sendStats&&this._statsSendClick(t),this.settings.sendStats&&this._statsSendShowByCards(t)},e._statsSendClick=function(t){var e=[];if(this.settings.advertCarouselStatParams){var n=this.settings.advertCarouselStatParams.filter(function(e){return e.nmId==t});if(!n||0==n.length)return;n=n[0],e.push(wb.stat.wrapParam("C1S",this.settings.productId)),e.push(wb.stat.wrapParam("ADID",n.advertId)),e.push(wb.stat.wrapParam("NMID",t)),e.push(wb.stat.wrapParam("POS",n.position)),e.push(wb.stat.wrapParam("CPM",n.cpm)),e.push(wb.stat.wrapParam("SID",n.subjectId)),e.push(wb.stat.wrapParam("BRID",n.brandId)),wb.stat.sendEvent("APDC",e,!0)}else e.push(wb.stat.wrapParam("ADID",this.settings.advertisementId)),e.push(wb.stat.wrapParam("NMID",t)),wb.stat.sendEvent("ACC",e)},e._statsSendShowByCards=function(t){var e,n=this;if(this.settings.advertCarouselStatParams&&0!=this.settings.advertCarouselStatParams.lenght){var s=document.querySelector(".j-promo-carousel-wrapper"),r=null==s?void 0:null===(e=s.querySelectorAll(".j-product-item:not(.".concat("j-shown-stat-sended",")")))||void 0===e?void 0:e.toArray();if(r&&0!=r.length){var o=this.settings.productId,i=this.settings.advertCarouselStatParams;if(t){var a=null;if(r.forEach(function(e){e.dataset.popupNmId!=t||(a=e)}),null==a)return;l(t),a.classList.add("j-shown-stat-sended")}else if("IntersectionObserver"in window){var d={root:s,threshold:.5};this.advCardsObserver=new IntersectionObserver(function(t,e){t.forEach(function(t){if(t.isIntersecting){if(e.unobserve(t.target),t.target.classList.contains("j-shown-stat-sended"))return;l(t.target.dataset.popupNmId),t.target.classList.add("j-shown-stat-sended")}})},d),r.forEach(function(t){n.advCardsObserver.observe(t)})}else r.forEach(function(t){l(t.dataset.popupNmId),t.classList.add("j-shown-stat-sended")})}}function l(t){var e=i.filter(function(e){return e.nmId==t});if(e&&0!=e.length){e=e[0];var n=[];n.push(wb.stat.wrapParam("C1S",o)),n.push(wb.stat.wrapParam("ADID",e.advertId)),n.push(wb.stat.wrapParam("NMID",t)),n.push(wb.stat.wrapParam("POS",e.position)),n.push(wb.stat.wrapParam("CPM",e.cpm)),n.push(wb.stat.wrapParam("SID",e.subjectId)),n.push(wb.stat.wrapParam("BRID",e.brandId)),wb.stat.sendEvent("APDS",n)}}},e._statsSendShow=function(){var t=[];this.settings.advertCarouselStatParams?this._statsSendShowByCards():(t.push(wb.stat.wrapParam("ADID",this.settings.advertisementId)),wb.stat.sendEvent("ACS",t))},e._loadRequiredModules=function(){return this.$moduleLoader.loadModuleAsync("lightSlider")},e._loadRequiredTemplate=function(){var t=this;return new Promise(function(e,n){$.views.loadTemplate(t.settings.tmplName).done(e).fail(n)})},e._loadGoodsAsync=function(){var t=this;if(this.settings.byNms)return this._loadGoodsByNmsAsync();if(this.settings.isFinishLook)return void 0===this.settings.nmIds||0===this.settings.nmIds.length?null:wb.xnm.getGoodsForRecommend(this.settings.nmIds).then(function(t){return{goods:t}}).catch(function(t){console.error(t.message)});if(this.settings.isPromo){var e=Object.keys(this.settings.query).map(function(e){return e+"="+t.settings.query[e]}).join("&");return this.$httpClient.fetchJSON(this.settings.fetchUrl+"?"+e).then(function(e){var n,s;if(e&&(null===(n=e.adsCarousel)||void 0===n?void 0:n.length)>0){var r=e.adsCarousel.map(function(t){return t.nmId});return t.settings.advertCarouselStatParams=e.adsCarousel,t.settings.productId=t.settings.query.nmId,wb.xnm.getGoodsForRecommend(r).then(function(t){return{goods:t}}).catch(function(t){console.error(t.message)})}return e&&(null===(s=e.goods)||void 0===s?void 0:s.length)>0?(t.settings.advertisementId=null==e?void 0:e.advertisementId,wb.xnm.fillRecommend(e.goods).then(function(t){return e})):null}).catch(function(t){console.error(t.message)})}if(this.settings.fetchUrl){var n=this.settings.query?Object.keys(this.settings.query).map(function(e){return e+"="+t.settings.query[e]}).join("&"):"";return this.$httpClient.fetchJSON(this.settings.fetchUrl+"?"+n).then(function(t){return t.nmIds?wb.xnm.getGoodsForRecommend(t.nmIds):null}).then(function(t){return{goods:t}}).catch(function(t){console.error(t.message)})}return fetch("/recommendations/providers",{method:"POST",body:this.$helper.objectSerializer({recommendations:[{location:this.settings.type,markupBlock:this.settings.markupBlock,orderedGoodsIds:this.settings.nmIds,cod1S:this.settings.cod1S}]})}).then(function(t){return t.json()}).then(function(t){return new Promise(function(e,n){$.processResponse(t,function(t){var n=t.recommendationsResults[0];e(n)},function(t){console.error(t),n()})})})},e._fillGoodsAsync=function(t,e){return new Promise(function(n,s){t=t.map(function(t){return{cod1S:t}}),wb.xnm.fillPrice(t,function(s,r){n("error"===r?e:t.filter(function(t){return t.price>0}))})})},e._loadGoodsByNmsAsync=function(){var t=this;return this._loadNmsAsync().then(function(e){if(e&&0!=e.length){var n=e.map(function(t){return{cod1S:t}}),s=new t.$helper.Deferred;return wb.xnm.fillPrice(n,function(){return s.resolve({goods:n.filter(function(t){return null!=t.name})})}),s.promise}})},e._loadNmsAsync=function(){return fetch("/recommendations/providers",{method:"POST",body:this.$helper.objectSerializer({recommendations:[{location:this.settings.type,markupBlock:this.settings.markupBlock,orderedGoodsIds:this.settings.nmIds}]}),headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(t){return t.json()}).then(function(t){return new Promise(function(e,n){$.processResponse(t,function(t){var n=t.recommendationsResults[0];e(n.nms)},function(t){console.error(t),n()})})})},t}();window.__spaModuleManager__.register("recommendationCarousel",t)}();

},{}]},{},[1]);
