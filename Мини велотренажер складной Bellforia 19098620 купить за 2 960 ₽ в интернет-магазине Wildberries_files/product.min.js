(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";function asyncGeneratorStep(e,t,o,n,r,i,s){try{var a=e[i](s),u=a.value}catch(e){return void o(e)}a.done?t(u):Promise.resolve(u).then(n,r)}function _asyncToGenerator(e){return function(){var t=this,o=arguments;return new Promise(function(n,r){var i=e.apply(t,o);function s(e){asyncGeneratorStep(i,n,r,s,a,"next",e)}function a(e){asyncGeneratorStep(i,n,r,s,a,"throw",e)}s(void 0)})}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var o=[],n=!0,r=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(o.push(s.value),!t||o.length!==t);n=!0);}catch(e){r=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(r)throw i}}return o}}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,n=new Array(t);o<t;o++)n[o]=e[o];return n}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var CommentsViewModel=function(e){function t(t){var o;return(o=e.call(this)||this).options=t,o.summary={},o.votes={},o.itemsGrouped=[],o.paging={currentPage:1,pageSize:20},o.sorting={colName:"date",order:"desc",sortMap:{date_asc:"dateAsc",date_desc:"dateDesc",vote_asc:"rankAsc",vote_desc:"rankDesc",mark_asc:"valuationAscSummary",mark_desc:"valuationDescSummary"},sortOrder:function(){return o.sorting.sortMap[o.sorting.colName+"_"+o.sorting.order]}},o.onlyWithPhoto=!1,o.photos=[],o}_inheritsLoose(t,e);var o=t.prototype;return o._groupByUserId=function(e){return _(e).reduce(function(e,t){var o=_(e).find({wbUserId:t.wbUserId});if(o){var n=e.indexOf(o);e[n].items.push(t),e[n].items=_(e[n].items).sortBy(function(e){return new Date(e.createdDate)})}else e.push({wbUserId:t.wbUserId,items:[t]});return e},[])},o._loadFeedback=function(e,t){var o={imtId:this.options.link,skip:(e-1)*this.paging.pageSize,take:this.paging.pageSize,order:this.sorting.sortOrder()};return t&&(o.hasPhoto=t),fetch(this.options.baseUrl+"feedbacks/site",{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()})},o._updateLazyLoadImages=function(){this.lazyImageLoader.update(document.querySelectorAll(this.options.containerSlr+" img.avatar"))},o.setProperty=function(e,t){$.observable(this).setProperty(e,t)},o.isFirstComment=function(e,t){return t[0].id===e},o.isLastComment=function(e,t){return _(t).last().id===e&&t.length>1},o.lastComment=function(e){return e[e.length-1]},o.showMore=function(e,t){var o=this;return e.preventDefault(),this.setProperty("loading",!0),this.setProperty("paging.currentPage",this.paging.currentPage+1),this._loadFeedback(this.paging.currentPage,this.onlyWithPhoto).then(function(e){$.observable(o.itemsGrouped).insert(o._groupByUserId(e.feedbacks||[])),o._updateLazyLoadImages()}).finally(function(){o.setProperty("loading",!1)}),!1},o.sortBy=function(e,t,o){return t.preventDefault(),this.setProperty("sorting.order",this.sorting.colName===e?"asc"===this.sorting.order?"desc":"asc":"desc"),this.setProperty("sorting.colName",e),this.filterFeedbacks(),!1},o.filterFeedbacks=function(){var e=this;this.setProperty("paging.currentPage",1),this._loadFeedback(this.paging.currentPage,this.onlyWithPhoto).then(function(t){$.observable(e).setProperty({itemsGrouped:e._groupByUserId(t.feedbacks||[])}),e._updateLazyLoadImages()})},o.toggleWithPhotos=function(e,t){this.setProperty("onlyWithPhoto",!this.onlyWithPhoto),this.filterFeedbacks()},o.openPhotoViewer=function(e,t,o){o.stopImmediatePropagation();var n=e.map(function(e){return{preview:e.minSizeUri,fullPath:e.fullSizeUri}});return this.photoViewer.showCompositeSwiper(n,t),!1},o.sizeMatch=function(e,t){var o=this.summary.sizeMatchPercentDict[e]||this.summary.sizeMatchPercentDict[t]||0;return{abs:Math.abs(o),str:o.toString()}},o.toggleComments=function(){return $.observable(this).setProperty("commentsToggled",!this.commentsToggled),!1},o.goToProfile=function(e,t){var o=this;return t.preventDefault(),this.$httpClient.fetchJSON("/profile/spa/profile/url",{method:"POST",body:new URLSearchParams({userId:e})}).then(function(e){return o.$router.moveTo(window.location.origin+e.url)}),!1},o.answerToComment=function(e,t,o){var n=this;Promise.all([this.$router.loadUserInfoAsync(),$.views.loadTemplateAsync("FeedbackCommentForm")]).then(function(r){_toArray(r);n.itemsGrouped.forEach(function(e){return e.items.forEach(function(e){n.closeAnswerToComment(e),e.comments&&e.comments.forEach(function(e){return n.closeAnswerToComment(e)})})});var i=n.$router.userInfo.userInfo;$.observable(t||e).setProperty({showAnswerForm:!0,answerModel:{user:i,answerText:e.wbUserDetails.name+", ",parent:t,comment:e,level:o}})})},o.submitAnswerToComment=function(e,t){var o,n,r=this;if($.observable(e).setProperty({formIsTouched:!0}),t.validate()){var i={feedbackId:e.comment.id,text:e.answerText,link:this.options.link};(null===(o=e.parent)||void 0===o?void 0:o.id)&&(i.parentId=null===(n=e.parent)||void 0===n?void 0:n.id),this.$httpClient.fetchJSON(this.$router.getChildRouteByName("SpaProductCardSubmitAnswer").path,{redirectUnauth:!0,method:"POST",body:new URLSearchParams(i)}).then(function(t){var o=e.parent?e.parent:e.comment,n=-1!==e.level&&e.parent?"children":"comments";o[n]?$.observable(o[n]).insert(t):$.observable(o).setProperty(n,[t]),r.closeAnswerToComment(o)}).catch(function(e){return e&&wb.popup.renderModalError(e.message)})}},o.closeAnswerToComment=function(e){$.observable(e).setProperty({showAnswerForm:!1,answerModel:null})},o.voteTo=function(e,t){var o=this;this.votes[e.id]||this.$httpClient.fetchJSON(this.$router.getChildRouteByName("SpaProductCardCommentVote").path,{method:"POST",body:new URLSearchParams({id:e.id,vote:t,link:this.options.link})},{redirectUnauth:!0}).then(function(){var n,r;$.observable(e).setProperty({votedPlus:t>0,votedMinus:t<0,votes:{pluses:((null===(n=e.votes)||void 0===n?void 0:n.pluses)||0)+(t>0?1:0),minuses:((null===(r=e.votes)||void 0===r?void 0:r.minuses)||0)+(t>0?0:1)}}),$.observable(o.votes).setProperty(e.id,t>0?"plus":"minus")})},o.leaveCommentComplaint=function(e){var t=this;this.complaintModel={submitCommentComplaint:function(o){$.observable(t.complaintModel).setProperty({formIsTouched:!0}),o.validate()&&t.$httpClient.fetchJSON(t.$router.getChildRouteByName("SpaProductCardSubmitComplaint").path,{method:"POST",body:new URLSearchParams({feedbackId:e,complaintType:t.complaintModel.complaintType})},{redirectUnauth:!0}).then(function(e){return wb.popup.renderModalError(e,t.$localziation.close)}).catch(function(e){return wb.popup.renderModalError(e.message)}).finally(function(){var e;return null===(e=t.complaintPopup)||void 0===e?void 0:e.close()})}},$.views.loadTemplateAsync("CommentComplaintPopup").then(function(e){t.complaintPopup=wb.popup.showCustomPopup({useCenteredFunction:!0,useHtml:!0,popupClassesList:["i-alert-complain-feedback","shown"],contentClasses:["content"],onShow:function(o){e.link(o.querySelector(".content"),t.complaintModel)}})}).catch(function(e){e.isUnauthorize||""==e.message||console.error(e.message)})},o.leaveAnswerComplaint=function(e){var t=this;wb.popup.confirm("<h1>Если Вы считаете этот ответ неприемлемым, сообщите нам</h1>",{contentClasses:["content"],classList:["i-confirm-delete-feedback","shown"],yes:"Сообщить",yesBtnClassList:["c-btn-main","yes"],noBtnClassList:["c-btn-base","no"]}).then(function(o){o&&t.$httpClient.fetchJSON(t.$router.getChildRouteByName("SpaProductCardSubmitAnswerComplaint").path+"?feedbackId="+e,{method:"POST"},{redirectUnauth:!0}).then(function(e){wb.popup.renderModalError(e,t.$localziation.close)}).catch(function(e){return wb.popup.renderModalError(e.message)})})},o.loadSummary=function(){return fetch(this.options.baseUrl+"summary/full",{method:"POST",body:JSON.stringify({imtId:this.options.link,skip:0,take:this.paging.pageSize}),headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){return new Promise(function(t){return t(e)})}).catch(function(){return Promise.resolve(null)})},o.loadVotes=function(){return this.$httpClient.fetchExt(this.options.baseUrl+"votes?imtId="+this.options.link).then(function(e){return e.json()}).then(function(e){return new Promise(function(t){return t(e)})}).catch(function(){return Promise.resolve(null)})},o.init=function(){var e=this;$.observable(this).setProperty({loading:!0}),Promise.all([$.views.loadTemplateAsync("ProductComments"),$.views.loadTemplateAsync("ProductPublicComments"),this.loadSummary(),this.loadVotes(),this.$moduleLoader.loadModuleAsync("lazyImageLoader")]).then(function(t){var o=_slicedToArray(t,5),n=(o[0],o[1],o[2]),r=o[3],i=o[4],s=n.photosUris||[];$.observable(e).setProperty({itemsGrouped:e._groupByUserId(n.feedbacks),photos:s,summary:{starsAvg:n.valuation,starsCount:Math.round(n.valuation),feedbackCount:n.feedbackCount,feedbackWithPhotoCount:n.feedbackCountWithPhoto,starsPercentDict:n.valuationDistribution,sizeMatchPercentDict:n.matchingSizeDistribution},votes:r&&r.votes||{},ready:!0,loading:!1}),e.options.mediaInit&&e.options.mediaInit(slides),e.lazyImageLoader=new i(e.options.containerSlr),e._updateLazyLoadImages(),e.$moduleLoader.loadModuleAsync("photoGalleryViewer").then(function(t){var o=e.photos.map(function(e,t){return{preview:e[0],fullPath:e[1]}});e.photoViewer=new t(t.data,t.template),e.photoViewer.makeGallery(o,".j-sw-slider-photo-comment .swiper-container")})}).catch(function(e){return console.log(e)})},o.destroy=function(){var e;null===(e=this.lazyImageLoader)||void 0===e||e.destroy()},_createClass(t,[{key:"haveSize",get:function(){return this.options.haveSize}}]),t}(WbSpaModel),CommentsEditorViewModel=function(e){function t(t,o,n,r){var i;return(i=e.call(this)||this).product=t,i.submitCommentUrl=r.submitCommentUrl,i.checkFeedbackContent=r.checkFeedbackContent,i.imageUploaderSettings=n,i.sizeMatches=_(o).map(function(e,t){return{name:e,value:t}}),i}_inheritsLoose(t,e);var o=t.prototype;return o._loadFeedbackGoodsAsync=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$httpClient.fetchJSON("/product/comments/goods?link="+this.product.link,{},{redirectUnauth:!0});case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",{isUnauthorize:!0,unathorizeMsg:e.t0.isCustomError?e.t0.message:this.$localziation.serverError});case 9:case"end":return e.stop()}},e,this,[[0,6]])}));return function(){return e.apply(this,arguments)}}(),o.fromVisibility=function(e){return e?e.value.toString():""},o.toVisibility=function(e){return _.findWhere(this.visibilities,{value:Number(e)})||{}},o.processRating=function(e,t){"click"===t.type?$.observable(this).setProperty({selectedRating:e}):$.observable(this).setProperty({hoverRating:"mouseover"===t.type?e:0})},o.submitComment=function(e){var t,o,n,r,i,s,a=this;if($.observable(this).setProperty({formIsTouched:!0}),e.validate()){var u={rating:this.selectedRating,cod1s:null!==(t=null===(o=this.selectedCod1S)||void 0===o?void 0:o.value)&&void 0!==t?t:this.namelessColor.cod1S,link:this.product.link,sizeMatch:null!==(n=null===(r=this.selectedSizeMatch)||void 0===r?void 0:r.value)&&void 0!==n?n:null,sizeName:null!==(i=null===(s=this.selectedSizeName)||void 0===s?void 0:s.value)&&void 0!==i?i:0,visibility:this.selectedVisibility.value,text:this.text};this.imageUploader.items.length>0&&(u.userPhotos=this.imageUploader.items.map(function(e){return e.split(",").pop()})),this._checkFeedbackContentAsync().then(function(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?a._showDiscussionPopupAsync():a._uploadFeedbackAsync(u)}).catch(function(e){return wb.popup.renderModalError(e.message)})}},o.destroy=function(){var e;null===(e=this.imageUploader)||void 0===e||e.destroy(),$.observable(this).setProperty({ready:!1})},o.init=function(){var e=this;return Promise.all([$.views.loadTemplateAsync("CommentsForm"),this._loadFeedbackGoodsAsync(),this.$moduleLoader.loadModuleAsync("imageUploader")]).then(function(t){var o=_slicedToArray(t,3),n=(o[0],o[1]),r=o[2];n.isUnauthorize?$.observable(e).setProperty({isUnauthorize:n.isUnauthorize,unathorizeMsg:n.unathorizeMsg}):$.observable(e).setProperty({isUnauthorize:n.isUnauthorize,unathorizeMsg:n.unathorizeMsg,isBanned:n.isBanned,colors:n.colors,namelessColor:n.namelessColor,sizes:n.sizes,visibilities:n.visibilities.slice(0,2).reverse(),selectedCod1S:n.selectedCod1S,selectedSizeName:n.selectedSizeName,selectedVisibility:n.selectedVisibility,ready:!0,selectedRating:5,hoverRating:0,imageUploader:new r.ImageUploader(e.imageUploaderSettings)})}).catch(function(e){return console.log(e)})},o._checkFeedbackContentAsync=function(){var e,t;return wb.settings.enableCommentContentCheck?this.$httpClient.fetchJSON(this.checkFeedbackContent,{method:"POST",body:new URLSearchParams({text:this.text,code1S:null!==(e=null===(t=this.selectedCod1S)||void 0===t?void 0:t.value)&&void 0!==e?e:this.namelessColor.cod1S})},{redirectUnauth:!0}):Promise.resolve(!1)},o._uploadFeedbackAsync=function(e){var t=this;return this.$httpClient.fetchJSON(this.submitCommentUrl,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}},{redirectUnauth:!0}).then(function(){return $.views.loadTemplateAsync("spacommentposted")}).then(function(e){$.observable(t).setProperty({ready:!1}),wb.popup.showCustomPopup({useCenteredFunction:!0,useHtml:!0,popupClassesList:["i-popup-check-review","shown"],contentClasses:["content"],onShow:function(t){t.querySelector(".content").innerHTML=e.render()}})}).catch(function(e){wb.popup.renderModalError(e.message)})},o._showDiscussionPopupAsync=function(){return $.views.loadTemplateAsync("spanotcommentpopup").then(function(e){return wb.popup.showCustomPopup({useCenteredFunction:!0,useHtml:!0,popupClassesList:["i-alert-complain-feedback","shown"],contentClasses:["content"],onShow:function(t){t.querySelector(".content").innerHTML=e.render()}}),Promise.resolve()}).catch(function(e){return console.error(e.message),Promise.reject("Template cannot be loaded")})},t}(WbSpaModel),QuestionsViewModel=function(e){function t(t){var o;return(o=e.call(this)||this).options=t,o.totalCount=0,o.paging={currentPage:1,pageSize:20},o}_inheritsLoose(t,e);var o=t.prototype;return o._loadQuestionsAsync=function(){return fetch(this.options.baseUrl+"questions?"+new URLSearchParams({imtId:this.options.link,skip:(this.paging.currentPage-1)*this.paging.pageSize,take:this.paging.pageSize}).toString(),{headers:{"Content-Type":"application/json"}}).then(function(e){return e.json()}).then(function(e){return new Promise(function(t){return t(e)})}).catch(function(){return Promise.resolve(null)})},o._updateLazyLoadImages=function(){this.lazyImageLoader.update(document.querySelectorAll(this.options.containerSlr+" img.avatar"))},o.showMore=function(e,t){var o=this;return e.preventDefault(),$.observable(this).setProperty({loading:!0}),$.observable(this).setProperty("paging.currentPage",this.paging.currentPage+1),this._loadQuestionsAsync().then(function(e){$.observable(o.questions).insert(e.questions),o._updateLazyLoadImages()}).finally(function(){$.observable(o).setProperty("loading",!1)}),!1},o.goToProfile=function(e,t){var o=this;return t.preventDefault(),this.$httpClient.fetchJSON("/profile/spa/profile/url",{method:"POST",body:new URLSearchParams({userId:e})}).then(function(e){return o.$router.moveTo(window.location.origin+e.url)}),!1},o.init=function(){var e=this;$.observable(this).setProperty({loading:!0}),Promise.all([$.views.loadTemplateAsync("ProductQuestions"),this._loadQuestionsAsync(),this.$moduleLoader.loadModuleAsync("lazyImageLoader")]).then(function(t){var o=_slicedToArray(t,3),n=(o[0],o[1]),r=o[2];$.observable(e).setProperty({ready:!0,questions:(null==n?void 0:n.questions)||[],loading:!1,totalCount:(null==n?void 0:n.count)||0}),e.lazyImageLoader=new r(e.options.containerSlr)}).catch(function(e){return console.log(e)})},o.destroy=function(){var e;null===(e=this.lazyImageLoader)||void 0===e||e.destroy()},t}(WbSpaModel),QuestionsEditorViewModel=function(e){function t(t,o){var n;return(n=e.call(this)||this).product=t,n.text="",n.submitQuestionUrl=o.submitQuestionUrl,n}_inheritsLoose(t,e);var o=t.prototype;return o.submitQuestion=function(e){var t=this;if($.observable(this).setProperty({formIsTouched:!0}),e.validate()){var o={imtId:this.product.link,text:this.text,goodsName:this.product.goodsName};this.$httpClient.fetchExt(this.submitQuestionUrl,{method:"POST",body:JSON.stringify(o),headers:{"Content-Type":"application/json"}}).then(function(){return $.views.loadTemplateAsync("spaquestionsubmited")}).then(function(e){wb.popup.showCustomPopup({useCenteredFunction:!0,useHtml:!0,popupClassesList:["i-popup-publication-answer","shown"],contentClasses:["content"],msg:e.render()}),$.observable(t).setProperty({text:"",opened:!1,formIsTouched:!1})}).catch(function(e){return wb.popup.renderModalError(e)})}},o.forceLogin=function(){return wb.auth.signIn.show({query:{returnUrl:window.location.href}})},o.toggle=function(e){$.observable(this).setProperty({opened:e||!this.opened})},o.destroy=function(){$.observable(this).setProperty({ready:!1})},o.init=function(){var e=this;wb.basket.getUser.then(function(t){$.views.loadTemplateAsync(t.isAuth?"QuestionsForm":"NotAuthorizeForm").then(function(){$.observable(e).setProperty({ready:!0,isAuth:t.isAuth})}).catch(function(e){e.isUnauthorize||console.log(e)})})},t}(WbSpaModel),PostsViewModel=function(e){function t(t){var o;return(o=e.call(this)||this).options=t,o.totalCount=0,o}_inheritsLoose(t,e);var o=t.prototype;return o._loadPostsAsync=function(){return this.$httpClient.fetchJSON(this.options.baseUrl+"?"+new URLSearchParams({cod1s:this.options.cod1s}).toString(),{method:"POST"}).then(function(e){return new Promise(function(t){return t(e)})}).catch(function(){return Promise.resolve(null)})},o._loadPostsCountAsync=function(){return this.$httpClient.fetchJSON(this.options.countUrl+"?"+new URLSearchParams({cod1s:this.options.cod1s}).toString(),{method:"POST"}).then(function(e){return new Promise(function(t){return t(e)})}).catch(function(){return Promise.resolve(null)})},o.update=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var o,n,r,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.options.cod1s=t,e.prev=1,e.next=4,Promise.all([this._loadPostsAsync(),this.$moduleLoader.loadModuleAsync("photoGalleryViewer")]);case 4:o=e.sent,n=_slicedToArray(o,2),r=n[0],i=n[1],this.$observable.setProperty({posts:r}),this.photoViewer=new i(i.data),this.photoViewer.wrapGallery(".j-sw-slider-articles-product .swiper-container"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),e.t0.isCustomError||console.error(e.t0.message),wb.popup.renderModalError(e.t0.isCustomError?e.t0.message:this.$localziation.serverError);case 17:case"end":return e.stop()}},e,this,[[1,13]])}));return function(t){return e.apply(this,arguments)}}(),o.init=function(){var e=this;$.observable(this).setProperty({loading:!0}),Promise.all([$.views.loadTemplateAsync("ProductPosts"),this._loadPostsCountAsync()]).then(function(t){var o=_slicedToArray(t,2),n=(o[0],o[1]);$.observable(e).setProperty({ready:!0,loading:!1,totalCount:(null==n?void 0:n.count)||0})}).catch(function(e){return console.log(e)})},t}(WbSpaModel);module.exports={CommentsViewModel:CommentsViewModel,CommentsEditorViewModel:CommentsEditorViewModel,QuestionsViewModel:QuestionsViewModel,QuestionsEditorViewModel:QuestionsEditorViewModel,PostsViewModel:PostsViewModel};

},{}],2:[function(require,module,exports){
"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var o=0,r=new Array(t);o<t;o++)r[o]=e[o];return r}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var o=[],r=!0,n=!1,i=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(o.push(s.value),!t||o.length!==t);r=!0);}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return o}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,o,r,n,i,s){try{var a=e[i](s),u=a.value}catch(e){return void o(e)}a.done?t(u):Promise.resolve(u).then(r,n)}function _asyncToGenerator(e){return function(){var t=this,o=arguments;return new Promise(function(r,n){var i=e.apply(t,o);function s(e){asyncGeneratorStep(i,r,n,s,a,"next",e)}function a(e){asyncGeneratorStep(i,r,n,s,a,"throw",e)}s(void 0)})}}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var BaseProductCardModel=require("./productBase"),_require=require("./product.comments"),CommentsViewModel=_require.CommentsViewModel,CommentsEditorViewModel=_require.CommentsEditorViewModel,QuestionsViewModel=_require.QuestionsViewModel,QuestionsEditorViewModel=_require.QuestionsEditorViewModel,PostsViewModel=_require.PostsViewModel;!function(){var e=function(e){function t(t){var o,r,n;return t=null!==(o=null===(r=t)||void 0===r?void 0:r.data)&&void 0!==o?o:t,(n=e.call(this,t)||this).getPonedItems=n.$router.getChildRouteByName("SpaProductCardPonedItems").path,n.addToPonedUrl=n.$router.getChildRouteByName("SpaProductCardAddToPoned").path,n.removeFromPonedUrl=n.$router.getChildRouteByName("SpaProductCardRemoveFromPoned").path,n.addToWlUrl=n.$router.getChildRouteByName("SpaProductCardAddToWl").path,n.getErrorTypesUrl=n.$router.getChildRouteByName("GetProductErrorTypes").path,n.getVideoReviewsUrl="https://video-reviews.wildberries.ru/api/v1/video-by-nm",n.recommendationUrlHelper.depends=["selectedNomenclature","selectedNomenclature.cod1S"],n.initComments=n.initComments.bind(_assertThisInitialized(n)),n.currentTab="c",n}_inheritsLoose(t,e);var o=t.prototype;return o.recommendationUrlHelper=function(){return{alsoBuy:wb.urlHelper.alsoBuyCatalog(this.selectedNomenclature.cod1S),similarGoods:wb.urlHelper.similarGoodsCatalog(this.selectedNomenclature.cod1S)}},o.onAfterRender=function(){this.afterRenderInit(!1)},o.onBeforeUnrender=function(){var e,t;null===(e=this.comments)||void 0===e||e.destroy(),null===(t=this.commentsEditor)||void 0===t||t.destroy()},o.onHistoryChange=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var o,r,n,i,s=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.length>1&&void 0!==s[1]&&s[1],r=window.location.hash.substring(1),null==t.selectedNomenclature&&(n=parseInt(this.$router.routeParameters.cod1S),this.$router.replaceState({selectedNomenclature:n},document.title,window.location.origin+$.views.helpers.productCardUrl(n,null,this.$router.queryParams.get("targetUrl")))),null==this.nomenclatures[t.selectedNomenclature]||o){e.next=5;break}return e.abrupt("return",this.updateNomenclature(t.selectedNomenclature,!0));case 5:return e.prev=5,e.next=8,this.$httpClient.fetchJSON(this.$router.prepareUrl(this.$router.currentRoute.requiredData));case 8:i=e.sent,this.fullUpdate(i,!1,r),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),wb.popup.renderModalError(e.t0.message);case 15:case"end":return e.stop()}},e,this,[[5,12]])}));return function(t){return e.apply(this,arguments)}}(),o.onSamePageNavigation=function(){window.dispatchEvent(new CustomEvent("spaTransition",{detail:{isFinished:!0}})),window.scrollTo(0,0)},o.showSocialSharePopup=function(){var e=this;$.views.loadTemplateAsync("productcardsocialshare").then(function(t){wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["i-socialshare-popup-v1","shown"],contentClasses:["content"],useCenteredFunction:!0,onShow:function(o){t.link(o.querySelector(".content"),{nameForSocialLinks:encodeURIComponent("".concat(e.productCard.goodsName,", ").concat(e.productCard.brandName)),urlForBigCard:window.location.origin+$.views.converters.urlForGood(e.selectedNomenclature.cod1S),urlForBigCardForSocial:window.location.origin+$.views.converters.urlForGood(e.selectedNomenclature.cod1S,!1,"SN"),isCopied:!1,copyLink:function(){var e,t=this;(null!==(e=navigator.clipboard)&&void 0!==e&&e.writeText?navigator.clipboard.writeText(this.urlForBigCardForSocial):this._copyFallback()).then(function(){$.observable(t).setProperty({isCopied:!0})})},_copyFallback:function(){var e=document.querySelector(".j-social-share-link");return e.focus(),e.setSelectionRange(0,e.value.length),document.execCommand("copy"),e.blur(),Promise.resolve()}})}})})},o.showErrorInformer=function(){var e=this,t=null==this.errorTypes?this.$httpClient.fetchJSON(this.getErrorTypesUrl,{},{redirectUnauth:!0}).then(function(t){return e.errorTypes=t.errorTypes,Promise.resolve(e.errorTypes)}):Promise.resolve(this.errorTypes),o=$.views.loadTemplateAsync("contenterrorinform"),r=this;Promise.all([t,o]).then(function(e){var t=_slicedToArray(e,2),o=t[0],n=t[1];wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["i-modal-card-error-report-v1","shown"],contentClasses:["content"],useCenteredFunction:!0,onShow:function(e){n.link(e.querySelector(".content"),{errors:o,selected:null,comment:"",cod1s:r.selectedNomenclature.cod1S,noTriesToSubmit:!0,hasBeenSubmited:r.submitedErrors,submitError:function(e,t){var o=this;if(t.preventDefault(),this.noTriesToSubmit&&$.observable(this).setProperty({noTriesToSubmit:!1}),e.validate()){var n=document.getElementById("contentErrorForm"),i=new FormData(n);r.$httpClient.fetchJSON(n.action,{method:n.method,body:i},{redirectUnauth:!0}).then(function(){$.observable(o).setProperty({hasBeenSubmited:!0}),r.submitedErrors=!0}).catch(function(e){wb.popup.renderModalError(e.message)})}}})}})})},o.showLooksPreview=function(){var e=this;this.$httpClient.fetchJSON("/spa/looksbyarticle/".concat(this.selectedNomenclature.cod1S)).then(function(t){!t.looks||t.looks.length<1||e.$moduleLoader.loadModuleAsync("looksPreview").then(function(e){new e(document.getElementById("lookPreviewsContainer"),t.looks,e.template).render()})}).catch(function(e){e.isCustomError||console.error(e.message)})},o.showVideoReviews=function(){var e=this;fetch(this.getVideoReviewsUrl+"?nm=".concat(this.selectedNomenclature.cod1S)).then(function(e){return e.json()}).then(function(t){var o;(null!==(o=null==t?void 0:t.length)&&void 0!==o?o:0)<=0||e.$moduleLoader.loadModuleAsync("videoReviews").then(function(o){e.videoReviews=new o(document.getElementById("videoReviewsContainer"),t,o.template,o.data),e.videoReviews.renderAsync()})}).catch(function(e){return!e.isCustomError&&console.error(e.message)})},o.disposeVideoReviews=function(){var e;null===(e=this.videoReviews)||void 0===e||e.dispose()},o._updateMetaTags=function(e){var t=[];t.push({tagName:"title",htmlContent:this._getMetaTagWithPrice(this.metaTags[e].title)}),t.push({tagName:"meta",attributesDictionary:{name:"description",content:this._getMetaTagWithPrice(this.metaTags[e].description)}}),this.$seoHelper.render(t)},o._getMetaTagWithPrice=function(e){var t,o,r,n=(null===(t=this.promoInfo)||void 0===t?void 0:t.priceWithCouponAndDiscount)>0?"".concat(this.$localziation.forAmount," ").concat($.views.converters.priceWithCurrencyV2(null!==(o=null===(r=this.promoInfo)||void 0===r?void 0:r.priceWithCouponAndDiscount)&&void 0!==o?o:0)):"";return e.replace(/%FORPRICE%/,n)},o.initComments=function(){this.$observable.setProperty({comments:new CommentsViewModel({baseUrl:wb.settings.feedbacksServiceUrl,cod1S:this.selectedNomenclature.cod1S,link:this.productCard.link,haveSize:this.haveSize,sizeMatchMap:wb.settings.productSizeMatchMap,containerSlr:"#Comments"})}),this.comments.init(),this.initQuestions(),this.initPosts()},o.initCommentsEditor=function(){return this.$observable.setProperty({commentsEditor:new CommentsEditorViewModel(this.productCard,wb.settings.productSizeMatchMap,this.imageUploaderSettings,{submitCommentUrl:this.$router.getChildRouteByName("SpaProductCardSubmitComment").path,checkFeedbackContent:this.$router.getChildRouteByName("SpaPredictComment").path})}),this.commentsEditor.init()},o.destroyCommentsEditor=function(){var e;null===(e=this.commentsEditor)||void 0===e||e.destroy()},o.initQuestions=function(){this.$observable.setProperty({questions:new QuestionsViewModel({baseUrl:wb.settings.questionsServiceUrl,link:this.productCard.link,containerSlr:"#Questions"})}),this.questions.init()},o.initQuestionsEditor=function(){this.$observable.setProperty({questionsEditor:new QuestionsEditorViewModel(this.productCard,{submitQuestionUrl:wb.settings.questionsServiceUrl+"question"})}),this.questionsEditor.init()},o.initPosts=function(){this.$observable.setProperty({posts:new PostsViewModel({baseUrl:this.$router.getChildRouteByName("SpaProductCardPosts").path,countUrl:this.$router.getChildRouteByName("SpaProductCardPostsCount").path,cod1s:this.selectedNomenclature.cod1S})}),this.posts.init()},o.switchTab=function(e,t){return t.preventDefault(),this.$observable.setProperty({currentTab:e}),"q"===this.currentTab?(!this.questions&&this.initQuestions(),!this.questionsEditor&&this.initQuestionsEditor()):"p"===this.currentTab&&this.posts&&!this.posts.posts&&this.posts.update(this.selectedNomenclature.cod1S),!1},o.showRulesPopup=function(e){return fetch($.views.converters.urlForJsTmpl("CommentGoodRules")).then(function(e){return e.text()}).then(function(e){wb.popup.showCustomPopup({msg:e,popupClassesList:["i-comment-rules-popup-v1","shown"],contentClasses:["popup-container"],useCenteredFunction:!0,useHtml:!0})}),!1},t}(BaseProductCardModel);wb.spa.registerViewModel(e)}();

},{"./product.comments":1,"./productBase":3}],3:[function(require,module,exports){
"use strict";function asyncGeneratorStep(e,t,r,o,i,n,s){try{var a=e[n](s),l=a.value}catch(e){return void r(e)}a.done?t(l):Promise.resolve(l).then(o,i)}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(o,i){var n=e.apply(t,r);function s(e){asyncGeneratorStep(n,o,i,s,a,"next",e)}function a(e){asyncGeneratorStep(n,o,i,s,a,"throw",e)}s(void 0)})}}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],o=!0,i=!1,n=void 0;try{for(var s,a=e[Symbol.iterator]();!(o=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);o=!0);}catch(e){i=!0,n=e}finally{try{o||null==a.return||a.return()}finally{if(i)throw n}}return r}}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,o)}return r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var VideoHelper=require("../modules/productCard/videoHelper"),Wb360Helper=require("../modules/productCard/360Helper"),WbZoom=require("../modules/wbZoom"),ProductBaseViewModel=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object.assign(this,e,t),this.addedToBasket=!1,this.addedToWl=!1,this.blinkSizes=!1,this.tonesFullyShown=!1,this.currentSlide=0,this.showAllSizes=null!=this.selectedSize,this.allSizesShown=null!=this.selectedSize,this.hideContentError=!1,this.errorTypes=null,this.submitedErrors=!1,this.renderRecent=!1,this.videoHelper=new VideoHelper("product-card-video".concat(r?"-popup":""),this.selectedNomenclature,this.productCard.adult),this.helper3d=new Wb360Helper(this.selectedNomenclature),this._showRecommendationCarousel=!0,this.currentSupplier=null,this.analiticState=this.$analitic.getState(),this.imageList.depends=["selectedNomenclature","properNomenclaturesOrder"],this.sizesList.depends=["selectedNomenclature","properNomenclaturesOrder"],this.showAddToBasketBtn.depends=["selectedNomenclature","selectedSize","addedToBasket","properNomenclaturesOrder"],this.showAddToWlBtn.depends=["selectedNomenclature","selectedSize","addedToWl","properNomenclaturesOrder"],this.showMoveToBasketBtn.depends=["selectedNomenclature","selectedSize","addedToBasket"],this.showMoveToWlBtn.depends=["selectedNomenclature","selectedSize","addedToWl"],this.showAddToPonedBtn.depends=["selectedNomenclature","selectedSize","properNomenclaturesOrder"],this.priceSummary.depends=["selectedNomenclature","selectedSize","properNomenclaturesOrder"],this.isItemPoned.depends=["selectedNomenclature","selectedSize","ponedItems^**"],this.nomenclaturesList.depends=["properNomenclaturesOrder"],this.formattedMinOrderSum.depends=["productCard.minOrderPrice"],this.deliveryHelper={},this.suppliersHelper={},this.imageCarousel=null,this.colorCarousel=null,this.videoReviews=null,this.ponedItems={},this._observeProperties(),this._updateGoogleTagParams(),this._updateCriterio()}var t=e.prototype;return t.priceSummary=function(){var e,t,r=this.promoInfo,o=null!==(e=(null===(t=this.promoInfo)||void 0===t?void 0:t.price)-(null==r?void 0:r.priceWithCouponAndDiscount))&&void 0!==e?e:this.priceForProduct.priceWithSale;return _objectSpread({priceRub:(null==r?void 0:r.priceWithCouponAndDiscount)>0?Math.floor(r.priceWithCouponAndDiscount*wb.settings.globalVariables.TO_RUB_EXCHANGE_RATE):null,finalSaving:o},r)},t.imageList=function(){var e=this;return Array.from({length:this.selectedNomenclature.picsCount},function(t,r){return $.views.helpers.ImageUrl(e.selectedNomenclature.cod1S,"tm",r+1)})},t.sizesList=function(){var e;return Object.values(null!==(e=this.selectedNomenclature.sizes)&&void 0!==e?e:{}).sort(function(e,t){return e.id-t.id})},t.showAddToBasketBtn=function(){return this.isBasketEnable&&!this.addedToBasket},t.showMoveToBasketBtn=function(){return this.isBasketEnable&&this.addedToBasket},t.showAddToWlBtn=function(){return this.isWlEnable&&!this.addedToWl},t.showMoveToWlBtn=function(){return this.isWlEnable&&this.addedToWl},t.showAddToPonedBtn=function(){var e;return(null!==(e=this.selectedSize)&&void 0!==e?e:this.selectedNomenclature).addToPonedEnable&&this.selectedNomenclature.enabledForRegion},t.isItemPoned=function(){var e,t;return!(null===(e=this.selectedSize)||void 0===e||!e.characteristicId)&&(null===(t=this.ponedItems[this.selectedNomenclature.cod1S])||void 0===t?void 0:t.indexOf(this.selectedSize.characteristicId))>-1},t.nomenclaturesList=function(){var e=this,t=this.properNomenclaturesOrder.reduce(function(t,r){return r!=e.selectedNomenclature.cod1S&&null!=e.nomenclatures[r]&&t.push(e.nomenclatures[r]),t},[]);return[this.selectedNomenclature].concat(_toConsumableArray(t))},t.formattedMinOrderSum=function(){return this.productCard.minOrderPrice>0?$.views.converters.priceWithCurrency(this.productCard.minOrderPrice):0},t.afterRenderInit=function(e){var t=this,r=this.selectedNomenclature.cod1S,o=window.location.hash.substring(1),i=location.search.indexOf("post=1")>0;!e&&this.$router.replaceState({selectedNomenclature:r},this._getMetaTagWithPrice(this.metaTags[r].title),window.location.href),this.$moduleLoader.loadModuleAsync("deliveryInfoHelper").then(function(r){var o,i=new r({productCard:t,reqestUrl:e?t.deliveryInfoUrl:t.$router.getChildRouteByName("SpaProductCardDeliveryInfo").path,expressStoreRequestUrl:e?t.expressStoreRequestUrl:t.$router.getChildRouteByName("SpaProductCardExpressStoreInfo").path,template:r.template});$.observable(t).setProperty({deliveryHelper:i}),t.deliveryHelper.updateAll(null===(o=t.selectedSize)||void 0===o?void 0:o.characteristicId)}),!e&&this.$moduleLoader.loadModuleAsync("suppliersInfoHelper").then(function(e){var o=new e({template:e.template,model:t});$.observable(t).setProperty({suppliersHelper:o}),t.suppliersHelper.update(r)}),!e&&wb.basket.getUser.then(function(e){$.observable(t).setProperty({hideContentError:!e.isAuth})});var n=document.querySelector("".concat(e?".content ":"",".j-swiper-color-carousel"));this.colorCarousel=new Swiper(n,_defineProperty({slidesPerView:e?3:5,spaceBetween:8,watchOverflow:!0,updateOnWindowResize:!0,navigation:{nextEl:n.parentNode.querySelector(".j-color-next"),prevEl:n.parentNode.querySelector(".j-color-prev"),disabledClass:"disabled",lockClass:"hide"}},e?null:"breakpoints",{1290:{slidesPerView:6},1450:{slidesPerView:7}}));var s=document.querySelector("".concat(e?".content ":"",".j-sw-images-carousel"));this.imageCarousel=new Swiper(s,_defineProperty({slidesPerView:e?4:3,spaceBetween:16,watchOverflow:!0,direction:"vertical",navigation:{nextEl:s.parentNode.querySelector(".j-product-carousel-next"),prevEl:s.parentNode.querySelector(".j-product-carousel-prev"),disabledClass:"disabled",lockClass:"hide"}},e?null:"breakpoints",{1057:{slidesPerView:4},1245:{slidesPerView:5}})),this._getPonedItems(),this.wbZoom=new WbZoom(".j-zoom-photo",{classList:["j-show-gallery"],adultOnly:this.productCard.adult,preview:".j-zoom-preview"}),this._sendViewProductStatistic(),this._checkSizeList(),this._saveAsRecentlyViews(),this.$adult.proceedIfAdultConfirmed(this.productCard.adult),e||(this._updateMetaTags(r),""!=o?this.$moveToAnchor(o):i&&this.initCommentsEditor().then(function(){var e=document.getElementsByClassName("new-post-add");e.length>0&&t.$helper.nextTick().then(function(){var t=e[0].getBoundingClientRect().y;window.scrollTo({top:t,left:0,behavior:"smooth"})})}))},t.fullUpdate=function(e,t,r){var o,i,n,s,a,l,d,c,u,h,p,m,v,f,b,y,S;!t&&(null===(o=this.comments)||void 0===o||o.destroy()),!t&&(null===(i=this.commentsEditor)||void 0===i||i.destroy()),!t&&this.$router.updateCriterio(e.counterEventsModel),!t&&window.scrollTo(0,0),e.data.selectedNomenclature.promoText=null!==(n=e.data.selectedNomenclature.promoText)&&void 0!==n?n:null,e.data.productCard.minOrderPrice=null!==(s=e.data.productCard.minOrderPrice)&&void 0!==s?s:0,e.data.productCard.consist=null!==(a=e.data.productCard.consist)&&void 0!==a?a:"",this.selectedNomenclature.minPriceForDcn={},this.selectedNomenclature.priceDetails={};var w=Object.values(e.data.selectedNomenclature.sizes),P=e.data.haveSize&&w.length>1?null:w[0];$.observable(this).setProperty({selectedSize:P,nomenclatures:e.data.nomenclatures,metaTags:e.data.metaTags,"selectedNomenclature.sizes":e.data.selectedNomenclature.sizes,commentsEditor:null,comments:null,"videoHelper.adultOnly":e.data.productCard.adult,"wbZoom.adultOnly":e.data.productCard.adult,currentTab:"c",addedToBasket:!1,addedToWl:!1,showAllSizes:!1,allSizesShown:!1}),$.observable(this).setAllProperty(e.data),$.observable(this.properNomenclaturesOrder).refresh(e.data.properNomenclaturesOrder),$.observable(this.selectedNomenclature.imageHelper).refresh(e.data.selectedNomenclature.imageHelper),$.observable(null!==(l=null==this?void 0:null===(d=this.searchTags)||void 0===d?void 0:d.tagsViewModels)&&void 0!==l?l:[]).refresh(null!==(c=null===(u=e.data.searchTags)||void 0===u?void 0:u.tagsViewModels)&&void 0!==c?c:[]),!t&&$.observable(this.productCard.groupedAddedOptions).refresh(e.data.productCard.groupedAddedOptions),!t&&$.observable(null!==(h=this.productCard.technologies)&&void 0!==h?h:[]).refresh(null!==(p=e.data.productCard.technologies)&&void 0!==p?p:[]),!t&&$.observable(null!==(m=this.selectedNomenclature.relatedGoods)&&void 0!==m?m:[]).refresh(null!==(v=e.data.selectedNomenclature.relatedGoods)&&void 0!==v?v:[]),!t&&$.observable(null!==(f=this.sitePath)&&void 0!==f?f:[]).refresh(null!==(b=e.data.sitePath)&&void 0!==b?b:[]),!t&&this.showRecommendationCarousel&&$.observable(this).setProperty({showRecommendationCarousel:!1}),!t&&this.suppliersHelper.fullUpdate(e.data,this.selectedNomenclature.cod1S),null===(y=(S=this.deliveryHelper).updateAll)||void 0===y||y.call(S,null,!0),this.imageCarousel.update(),this.colorCarousel.update(),this.videoHelper.reset(),this.helper3d.reset(this.selectedNomenclature),this._getPonedItems(),this._updateGoogleTagParams(),this._saveAsRecentlyViews(),this._updateCriterio(),this._resetTones(),this.$adult.proceedIfAdultConfirmed(this.productCard.adult),window.dispatchEvent(new CustomEvent("inPlaceFullUpdate",{detail:{isPopupMode:t}})),null!=r&&""!=r&&this.$moveToAnchor(r)},t.updateNomenclature=function(e,t,r){null==r||r.preventDefault(),null==r||r.stopPropagation(),null==r||r.stopImmediatePropagation(),this.$adult.proceedIfAdultConfirmed(this.productCard.adult,this._updateNomenclature,this,e,t,r)},t.updateSize=function(e){var t,r;$.observable(this).setProperty({selectedSize:this.selectedNomenclature.sizes[e],addedToBasket:!1,addedToWl:!1}),null===(t=(r=this.deliveryHelper).update)||void 0===t||t.call(r,e)},t.addToBasket=function(){var e=this;if(!this._addToBasketInProcess){if(this._addToBasketInProcess=!0,!this._validateSize())return this._addToBasketInProcess=!1,$.observable(this).setProperty("blinkSizes",!0);var t=this.currentModel;this.$httpClient.fetchJSON(this.urlHelper.toBasket,{method:"POST",body:new URLSearchParams(t)}).then(function(r){null!=r&&r.basketInfo&&wb.basket.basketShortUpdate(r.basketInfo),e._addToBasketSEO(),$.observable(e).setProperty("addedToBasket",!0),wb.xnm.updateProductColorsMap([{nmId:t.cod1S,color:e.selectedNomenclature.rusName}])}).catch(function(e){wb.popup.renderModalError(e.message)}).finally(function(){e._addToBasketInProcess=!1})}},t.purchaseDigitalProduct=function(){var e=this;this.$moduleLoader.loadModuleAsync("digitalContentPurchase").then(function(t){var r;e.$httpClient.fetchJSON("/product/digital/purchase",{method:"POST",body:new URLSearchParams({cod1s:e.selectedNomenclature.cod1S,rcpCod:null===(r=e.selectedSize)||void 0===r?void 0:r.characteristicId})},{redirectUnauth:!0}).then(function(e){wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["i-popup-payment-online","shown"],contentClasses:["content"],useCenteredFunction:!0,onShow:function(r){t.template.link(r.querySelector(".content"),new t(e))}})}).catch(function(e){e.isCustomError||console.error(e.message)})})},t.addToWl=function(){var e=this;if(!this._addToWlInProcess){if(this._addToWlInProcess=!0,!this._validateSize())return this._addToWlInProcess=!1,$.observable(this).setProperty("blinkSizes",!0);this.$httpClient.fetchJSON(this.addToWlUrl,{method:"POST",body:new URLSearchParams(this.currentModel)},{redirectUnauth:!0}).then(function(t){$.observable(e).setProperty("addedToWl",!0)}).catch(function(e){e.isCustomError||wb.popup.renderModalError(e.message)}).finally(function(){e._addToWlInProcess=!1})}},t.togglePonedStatus=function(){var e=this;if(!this._togglePonedInProcess){if(this._togglePonedInProcess=!0,!this._validateSize())return this._togglePonedInProcess=!1,$.observable(this).setProperty("blinkSizes",!0);(this.isItemPoned()?this._removeFromPoned():this._addToPoned()).then(function(){e._togglePonedInProcess=!1})}},t.removeBlink=function(){$.observable(this).setProperty("blinkSizes",!1)},t.showTableOfSizes=function(){var e=this,t=_toArray(this.selectedNomenclature.sizeTable),r=t[0],o=t.slice(1),i=Object.values(this.selectedNomenclature.sizes).reduce(function(e,t){return(e[t.sizeName]={chrtId:t.characteristicId,sizeName:t.sizeName})&&e},{}),n=this;Promise.all([this.$moduleLoader.loadModuleAsync("tinyscrollbar"),$.views.loadTemplateAsync("sizetable")]).then(function(t){var s=_slicedToArray(t,2),a=s[0],l=s[1],d=wb.popup.showCustomPopup({useHtml:!0,popupClassesList:["i-modal-table-of-sizes-v1","shown"],contentClasses:["content"],useCenteredFunction:!0,onShow:function(t){l.link(t.querySelector(".content"),{headCells:r,bodyCells:o,percentWidth:100/r.row.length,tableSelectedSize:{chrtId:null,sizeName:null},updateSize:function(e){$.observable(this.tableSelectedSize).setProperty(_objectSpread({},i[e]))},selectSize:function(){null!=this.tableSelectedSize.chrtId&&(n.updateSize(this.tableSelectedSize.chrtId),d.close())}}),e.$stat.sendEvent("PCDS",[e.$stat.wrapParam("C1S",e.selectedNomenclature.cod1S||0)]),e.$helper.nextTick().then(function(){new a(t.querySelector(".j-scrollbar"),{thumbSize:80,wheelLock:!1})})}})})},t.updateCurrentSlide=function(e){var t;$.observable(this).setProperty({currentSlide:e}),null===(t=this.videoHelper.player)||void 0===t||t.pause()},t.updateZoom=function(){var e;null===(e=this.wbZoom)||void 0===e||e.update()},t.showImageGallery=function(){var e=this;this.$moduleLoader.loadModuleAsync("photoGalleryViewer").then(function(t){var r=e.selectedNomenclature.imageHelper.map(function(e){return{fullPath:e.preview,preview:e.preview}});new t(t.data,t.template).showCompositeSwiper(r,e.currentSlide,!0,{classList:["goods-photo"]})})},t.proceedIfAdultConfirmed=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];e.apply(this,r)},t.toggleSizes=function(){$.observable(this).setProperty({showAllSizes:!1,allSizesShown:!0})},t.getDeliveryInfoBySize=function(e){return"function"==typeof this.deliveryHelper.getByChrtId?this.deliveryHelper.getByChrtId(e):null},t._observeProperties=function(){var e=this;$.observe(this,"selectedNomenclature","selectedNomenclature.cod1S",function(t,r){var o,i,n,s,a=r.value,l=r.path,d="cod1S"==l?a:e.selectedNomenclature.cod1S,c=e.selectedSize;if("selectedNomenclature"==l||!e.isPopup){var u=Object.values(e.selectedNomenclature.sizes);c=e.haveSize&&u.length>1?null:u[0]}null===(o=e._updateMetaTags)||void 0===o||o.call(e,d),$.observable(e).setProperty({addedToWl:!1,addedToBasket:!1,currentSlide:0,"videoHelper.selectedNomenclature":e.selectedNomenclature,"helper3d.cod1s":d,selectedSize:c}),null===(i=e.posts)||void 0===i||i.update(a.cod1S),setTimeout(function(){e.imageCarousel.update(),e.imageCarousel.slideTo(0)},50),"selectedNomenclature"==l&&e.helper3d.reset(a),e.videoHelper.reset(),e._sendViewProductStatistic(!0),e.$helper.nextTick().then(function(){return e._checkSizeList()}),$.observable(e).setProperty({showRecommendationCarousel:!1}),null===(n=(s=e.deliveryHelper).updateAll)||void 0===n||n.call(s)})},t._updateNomenclature=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r,o){var i,n,s,a,l,d,c,u,h,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.showTones||this.tonesFullyShown||!this._needtoOpenTones(o.currentTarget)){e.next=2;break}return e.abrupt("return",this._showAllTones());case 2:if((s=this.nomenclatures[t]).isDataLoaded){e.next=8;break}return e.next=6,fetch("https://wbx-content.wildberries.ru/ru/"+t+".json").then(function(e){return e.json()});case 6:if(a=e.sent){if(s.rusName=a.nm_colors_names,s.has3D=null===(l=a.media)||void 0===l?void 0:l.has_photo_360,s.hasVideo=null===(d=a.media)||void 0===d?void 0:d.has_video,a.sizes_table&&a.sizes_table.details_props){for(s.sizeTable=[],c=a.sizes_table.details_props.indexOf("RU"),u={row:[]},c>=0&&(u.row[0]=this.$localziation.russianSize),u.row[1]=this.$localziation.manufactureSize,h=2,p=2;p<a.sizes_table.details_props.length;p++)u.row[h++]=a.sizes_table.details_props[p];s.sizeTable.push(u),a.sizes_table.values.forEach(function(e){var t={row:[]};if(c>=0&&(t.row[0]=e.details[c]),t.row[1]=e.tech_size,e.details.length>2)for(var r=2;r<e.details.length;r++)t.row[r]=e.details[r];s.sizeTable.push(t)}),this.haveSize&&Object.keys(s.sizes).forEach(function(e){var t=a.sizes_table.values.find(function(t){return t.chrt_id==e});if(t&&a.sizes_table.details_props.length===t.details.length)for(var r=2;r<a.sizes_table.details_props.length;r++){var o={name:a.sizes_table.details_props[r],value:t.details[r]};s.sizes[e].dimensions.push(o)}})}s.isDataLoaded=!0}case 8:$.observable(this).setProperty({selectedNomenclature:s}),null===(i=(n=this.suppliersHelper).update)||void 0===i||i.call(n,t),this.isPopup||r||this.$router.addState({selectedNomenclature:t},this._getMetaTagWithPrice(this.metaTags[t].title),$.views.helpers.productCardUrl(t,null,this.targetInfo.targetUrl));case 11:case"end":return e.stop()}},e,this)}));return function(t,r,o){return e.apply(this,arguments)}}(),t._validateSize=function(){return!this.haveSize||null!=this.selectedSize},t._needtoOpenTones=function(e){var t=e.closest(".j-color"),r=t.nextElementSibling;if(null==r)return!1;var o=t.closest(".j-colors-list").getClientRects()[0];return r.getClientRects()[0].top>o.top+o.height},t._showAllTones=function(){var e=document.querySelector(".j-colors-list"),t=e.querySelector("ul");e.addEventListener("transitionend",function t(){e.style.maxHeight="none",e.removeEventListener("transitionend",t)}),e.classList.add("shown"),e.style.maxHeight=t.getClientRects()[0].height+"px",this.tonesFullyShown=!0},t._resetTones=function(){var e=document.querySelector(".j-colors-list");null!=e?(e.classList.remove("shown"),e.style.removeProperty("max-height"),this.tonesFullyShown=!1):console.warn("Tones carousel should always be in DOM. Need to check")},t._addToBasketSEO=function(){if(null!=window.APRT_DATA){var e={pageType:8,currentProduct:window.APRT_DATA.currentProduct};window.APRT_SEND&&window.APRT_SEND(e)}"undefined"!=typeof dataLayer&&dataLayer.push({event:"add_to_basket"})},t._getPonedItems=function(){var e=this;wb.basket.getUser.then(function(t){if(t.isAuth){var r=new URLSearchParams;Object.keys(e.nomenclatures).forEach(function(e){return r.append("codes1S",e)}),e.$httpClient.fetchJSON(e.getPonedItems,{method:"POST",body:r}).then(function(t){$.observable(e).setProperty({ponedItems:t})}).catch(function(e){e.isCustomError||console.error(e.message)})}})},t._addToPoned=function(){var e,t=this,r=this.selectedNomenclature.cod1S,o=null===(e=this.selectedSize)||void 0===e?void 0:e.characteristicId;return this.$httpClient.fetchJSON(this.addToPonedUrl,{method:"POST",body:new URLSearchParams(this.currentModel)},{redirectUnauth:!0}).then(function(){Array.isArray(t.ponedItems[r])?$.observable(t.ponedItems[r]).insert(o):$.observable(t.ponedItems).setProperty(_defineProperty({},r,[o]))}).catch(function(e){e.isUnauthorize||wb.popup.renderModalError(e.message)})},t._removeFromPoned=function(){var e,t=this,r=this.selectedNomenclature.cod1S,o=null===(e=this.selectedSize)||void 0===e?void 0:e.characteristicId;return this.$httpClient.fetchJSON(this.removeFromPonedUrl,{method:"POST",body:new URLSearchParams({chrtId:o})},{redirectUnauth:!0}).then(function(){var e=t.ponedItems[r].indexOf(o);$.observable(t.ponedItems[r]).remove(e)}).catch(function(e){e.isUnauthorize||wb.popup.renderModalError(e.message)})},t._sendViewProductStatistic=function(e){var t=[],r=this.selectedNomenclature.cod1S;t.push(this.$stat.wrapParam("GCL",r)),t.push(this.$stat.wrapParam("TURL",this.targetInfo.targetUrl)),t.push(this.$stat.wrapParam("REF",document.referrer.replace(/^[^:]+:\/\/[^\/]+/,""))),t.push(this.$stat.wrapParam("BRID",this.productCard.brandId)),t.push(this.$stat.wrapParam("SID",this.productCard.subjectId)),wb.abtest&&wb.abtest.forEach(function(e){return t.push(e)}),this.$stat.sendEvent("GCO",t),e&&$.when(wb.utils.script.require(wb.settings.scripts.externalStat),wb.externalStatPromise).then(function(){wb.externalStatInstance.handlers.productCardOpen(r)})},t._checkSizeList=function(){var e=document.querySelector(".j-size-list");null!=e&&$.observable(this).setProperty({showAllSizes:e.scrollHeight-e.clientHeight>40})},t._updateGoogleTagParams=function(){if(this.googleTagParams&&"{}"!=this.googleTagParams)try{window.google_tag_params=JSON.parse(this.googleTagParams)}catch(e){console.error("Error parsing googleTagParams ".concat(this.googleTagParams))}},t._updateCriterio=function(){null!=this.criterioProduct&&(window.CRITEO_CONF=[[{pageType:"product",ProductID:this.criterioProduct.productId,CustomerID:this.criterioProduct.customerId||0,Segment:"0"}],[7389,"pvx","",this.criterioProduct.popup?"000":"010",[[7723445,7723446]],{ProductID:["i",0],CustomerID:["ci",0],Segment:["si",0]}]])},t._saveAsRecentlyViews=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return $.observable(this).setProperty({renderRecent:!1}),t=this.selectedNomenclature.cod1S,wb.recentViews.addProduct(t),r=this.productCard.adult?"/visitedgoods":"/product/saverecent",o=new URLSearchParams({count:11}),this.productCard.adult||o.append("cod1S",t),e.prev=6,e.next=9,this.$httpClient.fetchText(r,{method:"POST",body:o});case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),e.t0.isCustomError||console.error(e.t0.message);case 14:return e.prev=14,$.observable(this).setProperty({renderRecent:!0}),e.finish(14);case 17:case"end":return e.stop()}},e,this,[[6,11,14,17]])}));return function(){return e.apply(this,arguments)}}(),_createClass(e,[{key:"minOrderCount",get:function(){return Math.ceil(this.productCard.minOrderPrice/this.promoInfo.priceWithCouponAndDiscount)}},{key:"showRecommendationCarousel",get:function(){return this._showRecommendationCarousel},set:function(e){var t=this;this._showRecommendationCarousel=e,e||setTimeout(function(){return $.observable(t).setProperty({showRecommendationCarousel:!0})},50)}},{key:"isBasketEnable",get:function(){var e;if(!this.selectedNomenclature.enabledForRegion)return!1;var t=(null!==(e=this.selectedSize)&&void 0!==e?e:{}).addToBasketEnable;return void 0===t?this.selectedNomenclature.addToBasketEnable:t}},{key:"isWlEnable",get:function(){var e;if(!this.selectedNomenclature.enabledForRegion)return!1;var t=(null!==(e=this.selectedSize)&&void 0!==e?e:{}).addToWaitingListEnable;return void 0===t?this.selectedNomenclature.addToWaitingListEnable:t}},{key:"promoInfo",get:function(){var e,t,r,o,i,n,s,a,l,d,c,u,h,p,m,v,f,b,y=this.selectedNomenclature,S=this.selectedSize;if(!this.isBasketEnable)return null;var w=null!==(e=null==S?void 0:S.priceDetails)&&void 0!==e?e:y.priceDetails;return{price:null!==(t=null!==(r=null!==(o=null==S?void 0:S.price)&&void 0!==o?o:(null==y?void 0:null===(i=y.minPriceForDcn)||void 0===i?void 0:i.item2)||(null==y?void 0:null===(n=y.minPriceForDcn)||void 0===n?void 0:n.Item2))&&void 0!==r?r:null==y?void 0:y.price)&&void 0!==t?t:0,priceWithCouponAndDiscount:null!==(s=null!==(a=null!==(l=null!==(d=null!==(c=null==w?void 0:w.clientPrice)&&void 0!==c?c:null==w?void 0:w.promoPrice)&&void 0!==d?d:null==w?void 0:w.basicPrice)&&void 0!==l?l:null==S?void 0:S.priceWithSale)&&void 0!==a?a:(null==y?void 0:null===(u=y.minPriceForDcn)||void 0===u?void 0:u.item1)||(null==y?void 0:null===(h=y.minPriceForDcn)||void 0===h?void 0:h.Item1))&&void 0!==s?s:this.priceForProduct.priceWithSale,priceDif:null==S&&this.priceForProduct.priceDif,initialSale:null==w?void 0:w.basicSale,priceWithInitialSale:null==w?void 0:w.basicPrice,couponDescFull:"Промокод",sale:null!==(p=null==w?void 0:w.promoSale)&&void 0!==p?p:0,priceWithCoupon:null!==(m=null==w?void 0:w.promoPrice)&&void 0!==m?m:null!==(v=null==w?void 0:w.basicPrice)&&void 0!==v?v:null!==(f=null==S?void 0:S.priceWithSale)&&void 0!==f?f:y.minPriceForDcn&&y.minPriceForDcn.item1||y.priceWithSale,finalPersonalDiscount:null!==(b=null==w?void 0:w.clientSale)&&void 0!==b?b:0}}},{key:"currentModel",get:function(){var e,t,r,o,i,n;return _objectSpread({cod1S:this.selectedNomenclature.cod1S,characteristicId:null!==(e=null===(t=this.selectedSize)||void 0===t?void 0:t.characteristicId)&&void 0!==e?e:0,quantity:1,priceWithCouponAndDiscount:null!==(r=null===(o=this.promoInfo)||void 0===o?void 0:o.priceWithCouponAndDiscount)&&void 0!==r?r:0,targetUrl:null===(i=this.targetInfo)||void 0===i?void 0:i.targetUrl,targetCode:null===(n=this.targetInfo)||void 0===n?void 0:n.targetCode,lw:this.isPopup?"IP":"IT"},this.analiticState)}}]),e}();module.exports=ProductBaseViewModel;

},{"../modules/productCard/360Helper":4,"../modules/productCard/videoHelper":5,"../modules/wbZoom":6}],4:[function(require,module,exports){
"use strict";var Wb360Helper=function(){function t(t){var e,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.nomenclature=t,this.speed=null!==(e=null==i?void 0:i.speed)&&void 0!==e?e:2,this.frames=null!==(r=null==i?void 0:i.frames)&&void 0!==r?r:12,this.isDragging=!1,this.pointerStartPosX=0,this.pointerStartPosY=0,this.monitorStartTime=0,this.monitorInt=50,this.currentFrame=0,this.renderSlide=0,this.currentImage.depends=["renderSlide","nomenclature"],t.has3D&&this._preloadImages()}var e=t.prototype;return e.currentImage=function(){var t=-this.renderSlide%this.frames;return t<0&&(t+=this.frames-1),"".concat(wb.helpers.url.urlFor3D(this.nomenclature.cod1S),"/").concat(t,".jpg")},e.onTrackBegin=function(t){"touchstart"!=t.type&&t.preventDefault();var e=this._getPointerEvent(t);this.pointerStartPosX=e.pageX,this.isDragging=!0},e.onTrackEnd=function(t){"touchend"!=t.type&&t.preventDefault(),this.isDragging=!1},e.reset=function(t){$.observable(this).setProperty({nomenclature:t,currentFrame:0}),this.nomenclature.has3D&&this._preloadImages(),this.pointerStartPosX=0,this.pointerStartPosY=0,this.monitorStartTime=0,this.monitorInt=50,$.observable(this).setProperty({renderSlide:0})},e.onTrackMove=function(t){if("touchmove"!=t.type&&t.preventDefault(),this.isDragging){var e=this._getPointerEvent(t),r=e.pageX;if(this.monitorStartTime<Date.now()-this.monitorInt){var i=r-this.pointerStartPosX,n=Math.ceil((this.frames-1)*this.speed*(i/t.currentTarget.clientWidth));0===Math.abs(n)&&(n=i>0?1:-1),this.endFrame=this.currentFrame+n,this.monitorStartTime=Date.now(),this.pointerStartPosX=e.pageX,this.pointerStartPosY=e.pageY,this._refresh()}}},e._getPointerEvent=function(t){return t.originalEvent.targetTouches?t.originalEvent.targetTouches[0]:t},e._refresh=function(){var t=Math[this.endFrame<this.currentFrame?"floor":"ceil"](.1*(this.endFrame-this.currentFrame));this.currentFrame+=t,$.observable(this).setProperty({renderSlide:this.currentFrame})},e._preloadImages=function(){for(var t=0;t<this.frames;t++){(new Image).src="".concat(wb.helpers.url.urlFor3D(this.nomenclature.cod1S),"/").concat(t,".jpg")}},t}();module.exports=Wb360Helper;

},{}],5:[function(require,module,exports){
"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,o=new Array(t);r<t;r++)o[r]=e[r];return o}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var VideoHelper=function(e){function t(t,r,o){var n;return(n=e.call(this)||this).videoSelector=t,n.selectedNomenclature=r,n.inited=!1,n.player=null,n.isPause=!1,n.needUpdate=!1,n.adultOnly=null!=o&&o,n.loadResourseTask=null,n}_inheritsLoose(t,e);var r=t.prototype;return r.show=function(){var e=this;(this.inited?this.needUpdate?this._updateAsync():Promise.resolve():this._initAsync()).then(function(){if(e.adultOnly&&!e.$adult.isConfirmed)return e.$adult.pushToQueue(function(){return e.player.play()});e.player.play()})},r.reset=function(){var e;null===(e=this.player)||void 0===e||e.pause(),$.observable(this).setProperty({isPause:!1,needUpdate:!0})},r.destroy=function(){var e;null===(e=this.player)||void 0===e||e.destroy()},r._updateAsync=function(){return this.player.src(this.videoSrc),this.needUpdate=!1,Promise.resolve()},r._initAsync=function(){var e,t=this;return this.loadResourseTask=null!==(e=this.loadResourseTask)&&void 0!==e?e:this._loadResoursesAsync(),this.loadResourseTask.then(function(){return t._set(),t.inited=!0,Promise.resolve()})},r._set=function(){var e=this,t=0;this.player=_V_(this.videoSelector),this.player.src(this.videoSrc),this.player.addEvent("play",this._onPlayCallback.bind(this)),this.player.addEvent("pause",this._onPauseCallback.bind(this)),this.player.ready(function(){e.player.volume(.5),e.player.muted(!0),e.player.addEvent("ended",function(){t<100&&setTimeout(function(){t++,e.player.play()},50)})})},r._loadResoursesAsync=function(){var e=this;return this.$httpClient.fetchJSON("/spa/modules/productcardvideo").then(function(t){var r,o;return Promise.all([].concat(_toConsumableArray((null!==(r=t.requiredCss)&&void 0!==r?r:[]).map(e.$helper.loadCssAsync)),_toConsumableArray((null!==(o=t.requiredJs)&&void 0!==o?o:[]).map(e.$helper.loadJsAsync))))})},r._onPlayCallback=function(){var e=this;$.observable(this).setProperty({isPause:!1}),this.adultOnly&&!this.$adult.isConfirmed&&this.player.pause(),this.$adult.proceedIfAdultConfirmed(this.adultOnly,function(){return e.player.play()},this)},r._onPauseCallback=function(){$.observable(this).setProperty({isPause:!0})},_createClass(t,[{key:"videoSrc",get:function(){return wb.helpers.productCard.videoUrl(this.selectedNomenclature.cod1S)+".mp4"}}]),t}(WbSpaModel);module.exports=VideoHelper;

},{}],6:[function(require,module,exports){
"use strict";function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,i){t.prototype=Object.create(i.prototype),t.prototype.constructor=t,_setPrototypeOf(t,i)}function _setPrototypeOf(t,i){return(_setPrototypeOf=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}var WbZoom=function(t){function i(i){var e,s,a,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(a=t.call(this)||this).image=document.querySelector(i),null==a.image?(console.warn("Image for zoom doesnt exist"),_assertThisInitialized(a)):(a.preview=document.querySelector(n.preview),a.canvas=null,a.ctx=null,a.displayRatio=1,a.zoomRatio=null!==(e=n.zoom)&&void 0!==e?e:1.7,a.adultOnly=null!==(s=n.adultOnly)&&void 0!==s&&s,a.options=n,a._renderZoom=a._renderZoom.bind(_assertThisInitialized(a)),a)}_inheritsLoose(i,t);var e=i.prototype;return e.update=function(){if(!this.inited)return this._init();this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this._render()},e._init=function(){var t,i=this;this.inited=!0,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),(null!==(t=this.options.classList)&&void 0!==t?t:[]).forEach(function(t){return i.canvas.classList.add(t)}),this.canvas.classList.add("hide"),this._render(),this.image.insertAdjacentElement("beforebegin",this.canvas),this._bindEvents()},e._render=function(){this.canvas.width=this.image.naturalWidth,this.canvas.height=this.image.naturalHeight;var t=this.preview.getBoundingClientRect();this.displayRatio=this.image.naturalWidth/t.width,this.ctx.drawImage(this.image,0,0)},e._bindEvents=function(){var t=this;this.preview.addEventListener("mouseenter",function(){t.preview.classList.add("hide"),t.canvas.classList.remove("hide")}),this.canvas.addEventListener("mousemove",this._renderZoom),this.canvas.addEventListener("mouseleave",function(){t.ctx.setTransform(1,0,0,1,0,0),t.ctx.drawImage(t.image,0,0),t.preview.classList.remove("hide"),t.canvas.classList.add("hide")})},e._renderZoom=function(t){if(!this.adultOnly||this.$adult.isConfirmed){var i,e,s=t.offsetX*this.displayRatio,a=t.offsetY*this.displayRatio;i=this.zoomRatio*s-this.canvas.width/2<0?0:Math.min(this.zoomRatio*s-this.canvas.width/2,this.canvas.width*(this.zoomRatio-1)),e=this.zoomRatio*a-this.canvas.height/2<0?0:Math.min(this.zoomRatio*a-this.canvas.height/2,this.canvas.height*(this.zoomRatio-1)),this.ctx.setTransform(this.zoomRatio,0,0,this.zoomRatio,-i,-e),this.ctx.drawImage(this.image,0,0)}},i}(WbSpaModel);module.exports=WbZoom;

},{}]},{},[2]);
