(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";!function(){var e=function(){function e(e){this.productCard=e.productCard,this.reqestUrl=e.reqestUrl,this.expressStoreRequestUrl=e.expressStoreRequestUrl,this.template=e.template,this.cityName="",this.storeIds=[],this.delivery={},this.deliveryInfoModel=null,this.expressStore=null,this._deliveryInfoTask=null,this._expressStoreTask=null,this.stores={507:"Москва",686:"Новосибирск",1193:"Хабаровск",1699:"Краснодар",1733:"Екатеринбург",2737:"Санкт-Петербург"}}var t=e.prototype;return t.updateAll=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.update(e,t),this.updateExpressStore()},t.update=function(e,t){var r=this;this.productCard.showAddToBasketBtn()?this._getDeliveryInfoAsync(t).then(function(){$.observable(r).setProperty({deliveryInfoModel:r._getOptionsByChrtId(e)})}):$.observable(this).setProperty({deliveryInfoModel:null})},t.updateExpressStore=function(){var e=this;this._getExpressStore().then(function(){var t,r;Object.values(null!==(t=null===(r=e.productCard.selectedNomenclature)||void 0===r?void 0:r.sizes)&&void 0!==t?t:[]).forEach(function(t){var r,s;$.observable(t).setProperty({isExpressDelivery:null!==(r=null==t?void 0:null===(s=t.storeIds)||void 0===s?void 0:s.some(function(t){return e.expressStore==t}))&&void 0!==r&&r})})}).catch(void 0)},t.getByChrtId=function(e){return this._getOptionsByChrtId(e)},t._getDeliveryInfoAsync=function(e){return this._deliveryInfoTask=null==this._deliveryInfoTask||e?this._initAsync():this._deliveryInfoTask,this._deliveryInfoTask},t._getExpressStore=function(){var e;return this._expressStoreTask=null!==(e=this._expressStoreTask)&&void 0!==e?e:this._initExpressStoreAsync(),this._expressStoreTask},t._initAsync=function(){var e=this;return this.$geo.getLocation().then(function(t){return e.$helper.isNumber(t.cityId)?e.$httpClient.fetchJSON(e.reqestUrl+"?latitude="+t.latitude+"&longitude="+t.longitude+"&cityId="+t.cityId).then(function(r){return e.cityName=t.city,e.storeIds=t.storeIds,e.delivery=r,Promise.resolve()}):Promise.reject()})},t._initExpressStoreAsync=function(){var e=this;return this.$geo.getLocation().then(function(t){return e.$httpClient.fetchJSON(e.expressStoreRequestUrl+"?latitude="+t.latitude+"&longitude="+t.longitude)}).then(function(t){e.expressStore=t.store})},t._getOptionsByChrtId=function(e){var t,r=this;if(!this.delivery)return null;var s={cityName:this.cityName};if(!Array.isArray(this.delivery.times)||this.delivery.times.length<1||!Array.isArray(this.storeIds))return s;var i=wb.settings.enableNm2ProductCard?this.delivery.times:this.delivery.times.filter(function(e){return r.storeIds.indexOf(e.storeId)>-1}),o=this._getStoresForSize(e),n=o?i.filter(function(e){return o.some(function(t){return t==e.storeId})}):[];if(0!==n.length){var l,u=n.reduce(function(e,t){return!e.priority||t.priority&&t.priority<e.priority?t:e});if(s.deliveryOption=Object.keys(n.reduce(function(e,t){return(e[t.deliveryOption]=!0)&&e},{})).join(", "),"ru"===wb.settings.currentLocale)s.storeName=null!==(l=this.stores[u.storeId])&&void 0!==l?l:this.stores[507];var d=new Date(u.closestDeliveryDate);return s.closestDeliveryDate=d>0?null!==(t=u.isSupposedDate)&&void 0!==t&&t?wb.helpers.estimatedDeliveryDateText(u.inDays,u.extraDays):new Date(d).format("dd MMMM").toLowerCase():null,this.delivery.remoteStores&&this.delivery.remoteStores.length>0?s.fromRemoteStore=this.delivery.remoteStores.indexOf(u.storeId)>=0:s.fromRemoteStore=null,s}},t._getStoresForSize=function(e){return e?this.productCard.selectedNomenclature.sizes[e].storeIds:Object.keys(Object.values(this.productCard.selectedNomenclature.sizes).reduce(function(e,t){return t.isSoldOut||t.storeIds.forEach(function(t){return e[t]=!0}),e},{}))},e}();window.__spaModuleManager__.register("deliveryInfoHelper",e)}();

},{}]},{},[1]);
